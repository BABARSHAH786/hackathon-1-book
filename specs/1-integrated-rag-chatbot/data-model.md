# Data Model: Integrated RAG Chatbot

## Entities

### User
Represents a textbook reader with background information, preferences, and interaction history

**Fields**:
- `id` (string): Unique identifier for the user
- `email` (string): User's email address
- `name` (string): User's display name
- `software_background` (string): User's software development experience level
- `hardware_background` (string): User's hardware experience level
- `personalization_preferences` (json): User's preferences for content adaptation
- `created_at` (datetime): Account creation timestamp
- `last_active` (datetime): Last activity timestamp

**Relationships**:
- One-to-many with `ChatSession`
- One-to-many with `UserQuery`

**Validation rules**:
- Email must be valid
- Background fields must be from a predefined set of options
- Created_at must be before last_active

### ChatSession
Represents a conversational session between the user and the chatbot

**Fields**:
- `id` (string): Unique identifier for the session
- `user_id` (string): Reference to the associated user
- `created_at` (datetime): Session creation timestamp
- `last_interaction_at` (datetime): Timestamp of last interaction in session
- `active` (boolean): Whether the session is currently active

**Relationships**:
- Many-to-one with `User`
- One-to-many with `UserQuery`

**Validation rules**:
- User_id must reference a valid user
- Created_at must be before last_interaction_at

### UserQuery
Represents a query submitted by the user

**Fields**:
- `id` (string): Unique identifier for the query
- `session_id` (string): Reference to the associated chat session
- `user_id` (string): Reference to the associated user
- `query_text` (string): The text of the user's question
- `selected_text` (string, optional): Text selected by the user (if applicable)
- `query_timestamp` (datetime): Time when query was submitted
- `context_metadata` (json): Metadata about the context where query was made (chapter, section, etc.)

**Relationships**:
- Many-to-one with `ChatSession`
- Many-to-one with `User`
- One-to-many with `AIResponse`

**Validation rules**:
- Session_id must reference a valid session
- Query text must not be empty
- Selected text must not exceed a reasonable character limit

### AIResponse
Represents a response generated by the AI system

**Fields**:
- `id` (string): Unique identifier for the response
- `query_id` (string): Reference to the associated user query
- `response_text` (string): The AI-generated response
- `generation_timestamp` (datetime): Time when response was generated
- `sources` (json): List of source references from the textbook used in the response
- `confidence_score` (float): Confidence level of the response (0.0-1.0)
- `tokens_used` (integer): Number of tokens used in generating the response

**Relationships**:
- Many-to-one with `UserQuery`

**Validation rules**:
- Query_id must reference a valid query
- Response text must not be empty
- Confidence score must be between 0.0 and 1.0
- Tokens_used must be a positive integer

### TextEmbedding
Represents vector embeddings of the textbook content

**Fields**:
- `id` (string): Unique identifier for the embedding
- `text_chunk` (string): The original text content
- `embedding_vector` (array of floats): The vector representation of the text
- `chapter` (string): The chapter identifier where this text appears
- `section` (string): The section identifier within the chapter
- `chunk_id` (string): Sequential identifier for the chunk within a section
- `metadata` (json): Additional metadata about the text chunk

**Validation rules**:
- Text chunk must not be empty
- Embedding_vector must have the correct dimensions (1536 for text-embedding-3-small)
- Chapter and section must be valid references to textbook content

### PersonalizedChapter
Represents a chapter that has been personalized for a specific user

**Fields**:
- `id` (string): Unique identifier for the personalized chapter
- `original_chapter_id` (string): Reference to the original chapter
- `user_id` (string): Reference to the user for whom it's personalized
- `personalized_content` (text): The personalized version of the chapter
- `generation_timestamp` (datetime): Time when personalization was created
- `complexity_level` (string): The complexity level of this personalization

**Relationships**:
- Many-to-one with `User`

**Validation rules**:
- User_id must reference a valid user
- Personalized_content must not be empty
- Complexity_level must be from a predefined set of options